---
title: "Setting Up Your Python Environment for API Interaction"
execute:
  echo: true
format:
  html:
    code-overflow: wrap
lightbox: true
---

You can run the Python parts of this workshop either in your browser (recommended) or on your own computer. This page helps you get set up so you can focus on the API concepts, not the tooling.

:::{.callout-note appearance="simple" collapse="true"}
## No coding experience required
You can follow along even if you’re new to coding. Some setup steps may feel unfamiliar at first—that’s normal.

- Questions? [Ask here](https://github.com/UCSB-Library-Research-Data-Services/text-analysis-series/issues/new?title=Python%20APIs%20Question){target="_blank"}.
- Want a gentle Python intro? Try [Python for Everybody](https://www.py4e.com/){target="_blank"}.
- UCSB Carpentry also offers beginner workshops: [upcoming events](https://carpentry.library.ucsb.edu/){target="_blank"}.

Also, don’t forget your **library resources**! Library catalogs often include excellent beginner-friendly programming books (print and online).
:::

:::{.callout-tip appearance="simple" collapse="true"}
## How to Run Python Code
There are many ways to run Python. For this workshop, we recommend a browser-based option like [Google Colab](https://colab.research.google.com/){target="_blank"} or [Binder](https://mybinder.org/){target="_blank"}. No installation required, and it’s easy to share work during a live session.

If you prefer to work locally, you can use an IDE such as [VSCodium](https://vscodium.com/){target="_blank"}, [Spyder](https://www.spyder-ide.org/){target="_blank"}, or [VS Code](https://code.visualstudio.com/){target="_blank"}.
:::

This workshop uses a **starter notebook** that’s already filled in with the code you’ll need. That way you can run cells immediately, follow along in a live workshop, and edit small parts without having to type everything from scratch.

::: {.text-center}
\| <a target="_blank" href="https://colab.research.google.com/github/UCSB-Library-Research-Data-Services/intro2APIs/blob/main/chapters/coding/exercise-DLPA.ipynb" style='text-decoration: none;'>
  <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
</a> | [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/UCSB-Library-Research-Data-Services/intro2APIs/main?urlpath=%2Fdoc%2Ftree%2Fchapters%2Fcoding%2Fexercise-DLPA.ipynb){target="_blank"} |
:::

## Libraries Used in This Workshop

Libraries are pre-built code packages that provide specific functionality. In this workshop, we’ll use a few libraries: one to make HTTP requests, one to keep our API key out of the notebook output, and one to extract keywords from text. The first cells in our notebook will be dedicated to installing and importing these libraries.

### Installing Libraries
```{python}
#| eval: false
#| output: false

# If you're running in Colab/Binder, you can install everything from inside the notebook.
%pip install httpx tqdm yake matplotlib
```

### Importing Libraries
```{python}
# Import built-in libraries
import os # For environment variable management
import time # For adding delays between API requests
import json # For working with JSON data
from getpass import getpass # For securely inputting API keys

# Import third-party libraries
import httpx # For making HTTP requests
from urllib.parse import urlsplit, parse_qsl, urlencode, urlunsplit # For URL manipulation
import yake # For keyword extraction
from tqdm import tqdm # For displaying progress bars
import matplotlib.pyplot as plt # For data visualization
```

## Constants

Technically speaking, a constant is a value that shouldn’t change once it’s set. Python doesn’t have a built-in mechanism to strictly enforce immutability, but it does rely on a strong community-adopted [naming convention](https://peps.python.org/pep-0008/#constants){target="_blank"}.

The "Pythonic" way to define a constant is to use all uppercase letters with underscores separating words. This signals to other developers that the variable's value should not be modified after it's set.

For our exercise, we will define the following constants. You can copy and paste this into your code:

```{python}
API_BASE_URL = "https://api.dp.la/v2/" 
ENV_VAR_NAME = "DPLA_API_KEY" 
FALLBACK_DATA_URL = "https://raw.githubusercontent.com/UCSB-Library-Research-Data-Services/intro2APIs/main/data/" 
```

## Storing Your API Key

Even though this isn’t a public application, it’s still good practice to keep your API key secure and avoid hardcoding it directly. We are going to store the API key as an **environment variable** (a variable that lives in your system’s environment rather than inside your notebook). This way, you can access it in your code without exposing it.

[`getpass`](https://docs.python.org/3/library/getpass.html){target="_blank"} is a built-in Python module that provides a secure way to handle sensitive information, such as passwords or any other sensitive credentials.

The method we will use is as follows:

```{python}
#| eval: false
# Check if the API key is already set as an environment variable
api_key = os.getenv(ENV_VAR_NAME)

# If the API key is not set, a prompt will ask to enter the API key
if not api_key:
    api_key = getpass(f"Enter your DPLA API key: ").strip()
    if not api_key:
        raise ValueError("No API key provided")
    # Store the API key as an environment variable for the current session
    os.environ[ENV_VAR_NAME] = api_key

print(f"API key set in environment variable '{ENV_VAR_NAME}'")
```
```{python}
#| echo: false
api_key = os.getenv(ENV_VAR_NAME)
if api_key:
    print(f"API key is set in environment variable '{ENV_VAR_NAME}'")
else:
    print(f"API key is not set yet. Set it in '{ENV_VAR_NAME}' before making requests.")
```

:::{.callout-important appearance="simple" collapse="false"}
## Never print your API key
Note that we printed a message confirming that the API key is set (and the name of the environment variable where it's stored), but we did not print the API key itself. This matters in notebooks because cell output can be saved and accidentally shared.
:::

### Test the API Key

To test that your API key is working, you can make a simple request to the DPLA API. You can copy and paste this code into a cell in your notebook:

```{python}
# Make a test request to the DPLA API
if not api_key:
    print(
        "No API key found yet. Set the 'DPLA_API_KEY' environment variable (or run the getpass cell above) and re-run this cell."
    )
else:
    test_url = f"{API_BASE_URL}items?api_key={api_key}&page_size=1"
    response = httpx.get(test_url)
    if response.status_code == 200:
        print("API key is valid! Here's a sample response:")
        print(json.dumps(response.json(), indent=2))
    else:
        print(f"Failed to connect to the API. Status code: {response.status_code}")
        print(f"Response: {response.text}")
```

Having all the libraries in place and the API key securely stored, now it’s time to start querying.
