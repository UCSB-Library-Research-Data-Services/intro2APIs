{
  "hash": "a62989eb290c3731572776ca693059e9",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Setting Up Your Python Environment for API Interaction\"\nexecute:\n    echo: true\nformat:\n    html:\n        code-fold: false\nlightbox: true\n---\n\n\n\n\nYou can run the Python parts of this workshop either in your browser (recommended) or on your own computer. This page helps you get set up so you can focus on the API concepts, not the tooling.\n\n:::{.callout-note appearance=\"simple\" collapse=\"true\"}\n## No coding experience required\nYou can follow along even if you’re new to coding. Some setup steps may feel unfamiliar at first—that’s normal.\n\n- Questions? [Ask here](https://github.com/UCSB-Library-Research-Data-Services/text-analysis-series/issues/new?title=Python%20APIs%20Question){target=\"_blank\"}.\n- Want a gentle Python intro? Try [Python for Everybody](https://www.py4e.com/){target=\"_blank\"}.\n- UCSB Carpentry also offers beginner workshops: [upcoming events](https://carpentry.library.ucsb.edu/){target=\"_blank\"}.\n\nAlso, don’t forget your **library resources**! Library catalogs often include excellent beginner-friendly programming books (print and online).\n:::\n\n:::{.callout-tip appearance=\"simple\" collapse=\"true\"}\n## How to Run Python Code\nThere are many ways to run Python. For this workshop, we recommend a browser-based option like [Google Colab](https://colab.research.google.com/){target=\"_blank\"} or [Binder](https://mybinder.org/){target=\"_blank\"}. No installation required, and it’s easy to share work during a live session.\n\nIf you prefer to work locally, you can use an IDE such as [VSCodium](https://vscodium.com/){target=\"_blank\"}, [Spyder](https://www.spyder-ide.org/){target=\"_blank\"}, or [VS Code](https://code.visualstudio.com/){target=\"_blank\"}.\n:::\n\nThis workshop uses a **starter notebook** that’s already filled in with the code you’ll need. That way you can run cells immediately, follow along in a live workshop, and edit small parts without having to type everything from scratch.\n\n::: {.text-center}\n\\| <a target=\"_blank\" href=\"https://colab.research.google.com/github/UCSB-Library-Research-Data-Services/intro2APIs/blob/main/chapters/coding/exercise-DLPA.ipynb\" style='text-decoration: none;'>\n  <img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/>\n</a> | [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/UCSB-Library-Research-Data-Services/intro2APIs/main?urlpath=%2Fdoc%2Ftree%2Fchapters%2Fcoding%2Fexercise-DLPA.ipynb){target=\"_blank\"} |\n:::\n\n## Libraries Used in This Workshop\n\nLibraries are pre-built code packages that provide specific functionalities. In our case, we're going to require a library that help us to make HTTP requests, one that keeps our API key secure, and one that helps us extract keywords from text. The first cells in our notebook will be dedicated to installing and importing these libraries.\n\n### Installing Libraries\n\n::: {#2fbf72ac .cell execution_count=1}\n``` {.python .cell-code}\n%pip install yake # Keyword extraction library\n%pip install tqdm # Progress bar library\n%pip install httpx # HTTP client library\n```\n:::\n\n\n### Importing Libraries\n\n::: {#cfd5250d .cell execution_count=2}\n``` {.python .cell-code}\n# Import built-in libraries\nimport os # For environment variable management\nimport time # For adding delays between API requests\nimport json # For working with JSON data\nfrom getpass import getpass # For securely inputting API keys\n\n# Import third-party libraries\nimport httpx # For making HTTP requests\nimport yake # For keyword extraction\nfrom tqdm import tqdm # For displaying progress bars\nimport matplotlib.pyplot as plt # For data visualization\n```\n:::\n\n\n\n\n## Constants\n\nTechnically speaking, a constant is a value that cannot be changed once it's set. Python doesn't have a built-in mechanism to strictly enfonce this immutability, but relies on a strong community-adopted [naming convention](https://peps.python.org/pep-0008/#constants){target=\"_blank\"}.\n\nThe \"Pythonic\" way to define a constant is to use all uppercase letters with underscores separating words. This signals to other developers that the variable's value should not be modified after it's set.\n\nFor our exercise, we will define the following constants. You can copy and paste this into your code:\n\n::: {#77c05c18 .cell execution_count=4}\n``` {.python .cell-code}\nAPI_BASE_URL = \"https://api.dp.la/v2/\" \nENV_VAR_NAME = \"DPLA_API_KEY\" \nFALLBACK_DATA_URL = \"https://raw.githubusercontent.com/UCSB-Library-Research-Data-Services/intro2APIs/refs/heads/main/data/\" \n```\n:::\n\n\n## Storing Your API Key\n\nAlthough technically this is not a public application, it's still good practice to keep your API key secure and avoid hardcoding it directly, to avoid accidentally sharing it with your code. We are going to store the API key as an **environment variable**, that is, a variable that lives in your system's environment rather than in your code. This way, you can access it in your code without exposing it directly.\n\n[`getpass`](https://docs.python.org/3/library/getpass.html){target=\"_blank\"} is a built-in Python module that provides a secure way to handle sensitive information, such as passwords or any other sensitive credentials.\n\nThe method we will use is as follows:\n\n::: {#1e80c868 .cell execution_count=5}\n``` {.python .cell-code}\n# Check if the API key is already set as an environment variable\napi_key = os.getenv(ENV_VAR_NAME)\n\n# If the API key is not set, a prompt will ask to enter the API key\nif not api_key:\n    api_key = getpass(f\"Enter your DPLA API key: \").strip()\n    if not api_key:\n        raise ValueError(\"No API key provided\")\n    # Store the API key as an environment variable for the current session\n    os.environ[ENV_VAR_NAME] = api_key\n\nprint(f\"API key set in environment variable '{ENV_VAR_NAME}'\")\n```\n:::\n\n\n::: {#a5908a91 .cell execution_count=6}\n\n::: {.cell-output .cell-output-stdout}\n```\nAPI key is set in environment variable 'DPLA_API_KEY'\n```\n:::\n:::\n\n\n:::{.callout-important appearance=\"simple\" collapse=\"false\"}\n## Never print your API key\nNote that we printed a message confirming that the API key is set, and the name of the environment variable where it's stored, but we did not print the API key itself. This is a crucial, particularly when working in Jupyter notebooks, where the output of cells is saved and can be accidentally shared. Always avoid printing sensitive information like API keys, even in development environments.\n:::\n\n### Test the API Key\n\nTo test that your API key is working, you can make a simple request to the DPLA API. You can copy and paste this code into a cell in your notebook:\n\n::: {#2461bc8b .cell execution_count=7}\n``` {.python .cell-code}\n# Make a test request to the DPLA API\ntest_url = f\"{API_BASE_URL}items?api_key={api_key}&page_size=1\"\nresponse = httpx.get(test_url)\nif response.status_code == 200:\n    print(\"API key is valid! Here's a sample response:\")\n    print(json.dumps(response.json(), indent=2))\nelse:\n    print(f\"Failed to connect to the API. Status code: {response.status_code}\")\n    print(f\"Response: {response.text}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAPI key is valid! Here's a sample response:\n{\n  \"count\": 53194696,\n  \"docs\": [\n    {\n      \"@context\": \"http://dp.la/api/items/context\",\n      \"@id\": \"http://dp.la/api/items/61730f4fd818bd0626a419ef82a88d40\",\n      \"@type\": \"ore:Aggregation\",\n      \"aggregatedCHO\": \"#sourceResource\",\n      \"dataProvider\": {\n        \"@id\": \"http://dp.la/api/contributor/center-for-sacramento-history\",\n        \"name\": \"Center for Sacramento History\"\n      },\n      \"id\": \"61730f4fd818bd0626a419ef82a88d40\",\n      \"ingestDate\": \"2024-02-01T16:27:52.667Z\",\n      \"ingestType\": \"item\",\n      \"isShownAt\": \"https://sacramento.pastperfectonline.com/photo/3F9DAD12-BD08-4B41-B6E1-024530408380\",\n      \"object\": \"https://thumbnails.calisphere.org/clip/150x150/eda2796f3877e7cfe971e54e0dcd7d5f\",\n      \"originalRecord\": {\n        \"stringValue\": \"{\\n  \\\"collection_url\\\" : [ \\\"https://registry.cdlib.org/api/v1/collection/26935/\\\" ],\\n  \\\"repository_name\\\" : [ \\\"Center for Sacramento History\\\" ],\\n  \\\"url_item\\\" : \\\"https://sacramento.pastperfectonline.com/photo/3F9DAD12-BD08-4B41-B6E1-024530408380\\\",\\n  \\\"repository_data\\\" : [ \\\"https://registry.cdlib.org/api/v1/repository/174/::Center for Sacramento History\\\" ],\\n  \\\"rights\\\" : [ \\\"Please contact the contributing institution for more information regarding the copyright status of this object.\\\" ],\\n  \\\"rights_ss\\\" : [ \\\"Please contact the contributing institution for more information regarding the copyright status of this object.\\\" ],\\n  \\\"reference_image_dimensions\\\" : \\\"211:210\\\",\\n  \\\"collection_name\\\" : [ \\\"Center for Sacramento History Photo Collection\\\" ],\\n  \\\"collection_data\\\" : [ \\\"https://registry.cdlib.org/api/v1/collection/26935/::Center for Sacramento History Photo Collection\\\" ],\\n  \\\"sort_title\\\" : \\\"print photographic color\\\",\\n  \\\"reference_image_md5\\\" : \\\"eda2796f3877e7cfe971e54e0dcd7d5f\\\",\\n  \\\"facet_decade\\\" : [ \\\"unknown\\\" ],\\n  \\\"sort_collection_data\\\" : [ \\\"center for sacramento history photo collection:Center for Sacramento History Photo Collection:https://registry.cdlib.org/api/v1/collection/26935/\\\" ],\\n  \\\"harvest_id_s\\\" : \\\"26935--3F9DAD12-BD08-4B41-B6E1-024530408380\\\",\\n  \\\"repository_url\\\" : [ \\\"https://registry.cdlib.org/api/v1/repository/174/\\\" ],\\n  \\\"title\\\" : [ \\\"Print, Photographic, Color\\\" ],\\n  \\\"title_ss\\\" : [ \\\"Print, Photographic, Color\\\" ],\\n  \\\"identifier\\\" : [ \\\"3F9DAD12-BD08-4B41-B6E1-024530408380\\\", \\\"1983/001/SBPM08387\\\" ],\\n  \\\"identifier_ss\\\" : [ \\\"3F9DAD12-BD08-4B41-B6E1-024530408380\\\", \\\"1983/001/SBPM08387\\\" ],\\n  \\\"type\\\" : [ \\\"Image\\\" ],\\n  \\\"type_ss\\\" : [ \\\"Image\\\" ],\\n  \\\"id\\\" : \\\"d6e9e727a3b58ae727960f7d74d0dd38\\\",\\n  \\\"subject\\\" : [ \\\"McClellan Air Force Base\\\" ],\\n  \\\"subject_ss\\\" : [ \\\"McClellan Air Force Base\\\" ],\\n  \\\"_version_\\\" : 1768714413655719936,\\n  \\\"timestamp\\\" : \\\"2023-06-14T21:18:29.361Z\\\"\\n}\"\n      },\n      \"provider\": {\n        \"@id\": \"http://dp.la/api/contributor/cdl\",\n        \"exactMatch\": [\n          \"http://www.wikidata.org/entity/Q5020447\"\n        ],\n        \"name\": \"California Digital Library\"\n      },\n      \"rightsCategory\": \"Unspecified Rights Status\",\n      \"sourceResource\": {\n        \"@id\": \"http://dp.la/api/items/61730f4fd818bd0626a419ef82a88d40#SourceResource\",\n        \"collection\": [\n          {\n            \"title\": \"Center for Sacramento History Photo Collection\"\n          }\n        ],\n        \"identifier\": [\n          \"3F9DAD12-BD08-4B41-B6E1-024530408380\",\n          \"1983/001/SBPM08387\"\n        ],\n        \"rights\": [\n          \"Please contact the contributing institution for more information regarding the copyright status of this object.\"\n        ],\n        \"subject\": [\n          {\n            \"name\": \"McClellan Air Force Base\"\n          }\n        ],\n        \"title\": [\n          \"Print, Photographic, Color\"\n        ],\n        \"type\": [\n          \"image\"\n        ]\n      }\n    }\n  ],\n  \"facets\": [],\n  \"limit\": 1,\n  \"start\": 1\n}\n```\n:::\n:::\n\n\n",
    "supporting": [
      "python-setting-up_files"
    ],
    "filters": [],
    "includes": {}
  }
}